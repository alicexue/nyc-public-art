<!DOCTYPE html>
<head>
    <title> Public Art Finder</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/static/js/jquery-3.1.1.js"></script>
    <script type="text/javascript" src="/static/js/sijax/sijax.js"></script>
</head>
<body style="background-image: url('http://www.theplunge.com/images/new_york_city.jpg')">
  <div class="container" >
      <div class="jumbotron" style="background-color:transparent !important;">
      <h1 style="color:white; font-family: Arial Black; text-align: center">PubArt: Where Art Meets Community!</h1>
    </div>
  <div class="container" style ='background-color: #2ba6cb;'>
    <div class="row">
        <div class="col-sm-6">
          <div id="googleMap" style="width:100%;height:400px;"></div>
        </div>
        <div class="col-sm-6">
          <div id="artPic" style="width:100%;height:400px;">
            <img id="art-photo" src="/static/ArtPic.jpg" class="img-responsive" >
            <p id="art-description" style="color:black;">This is a temp art piece by Blah Blah and heres a description</h4>
          </div>
        </div>
      </div>
  </div>
  <script>
function myMap() {
var mapProp = {
    center:new google.maps.LatLng(40.728857, -73.960074),
    zoom:11,
};
var map=new google.maps.Map(document.getElementById("googleMap"),mapProp);


jQuery.get('http://localhost:8080/facilities.json',function(facilities){
    for (i=0;i<Object.keys(facilities).length;i++) {
    	//add markers
		var myLatLng = {lat: facilities[i]['lat'], lng: facilities[i]['lng']};
		var marker = new google.maps.Marker({
  		position: myLatLng,
  		map: map,
  		title: facilities[i]['name']
		});
		content = '<p><b>' + facilities[i]['name'] + '</b></p><p>' + facilities[i]['artist'] + '</p><p>' + facilities[i]['from_date'] + ' to ' + facilities[i]['to_date'] + '</p>' 
		photo_link = facilities[i]['photo']
		photo_description = facilities[i]['description']
		var infowindow = new google.maps.InfoWindow({
    		content: content
 		 });
 		google.maps.event.addListener(marker,'click', (function(marker,content,infowindow,photo_link,photo_description){ 
    	return function() {
        	infowindow.setContent(content);
        	infowindow.open(map,marker);
        	console.log(photo_link)
        	console.log(photo_link.substr(0,photo_link.length - 2))
        	console.log(document.getElementById("art-photo"))
        	o_html = photo_link.substr(0,photo_link.length - 2) + " id = \"art-photo\" class=\"img-responsive\"/>";
        	document.getElementById("art-photo").outerHTML = o_html;
        	document.getElementById("art-description").innerHTML = photo_description;
    		};
		})(marker,content,infowindow,photo_link,photo_description));  
    }
});


// don't let people pan past NYC
var allowedBounds = new google.maps.LatLngBounds(
  new google.maps.LatLng(40.488482, -74.267916),
  new google.maps.LatLng(41.296556, -73.653525)
);
var lastValidCenter = map.getCenter();


map.addListener('center_changed', function() {
     if (allowedBounds.contains(map.getCenter())) {
        lastValidCenter = map.getCenter();
     }
     else {
       // not valid anymore => return to last valid position
       map.panTo(lastValidCenter);
     }
});


}
  </script>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyARHssahiNcsY3V-T_yX5J0PlP4nrmGRwA&callback=myMap"></script>
      <!--Maybe, once youve entered your address or allowed your current location,
         a carousel of pictures of the art around you -->

          <h3 style="color:black;">Sign up for updates about the art around you: </h3>
              <div class="col-xs-4">
            <form class="form-inline" role="form" id="user" method="POST">
              <input type="email" class="form-control" id="email_form" placeholder="Enter email" name="email_form">
                  <button type="submit" class="btn btn-default">Submit</button>
                </form>
            </div>
          </div>
    </div>
  </div>
</body>